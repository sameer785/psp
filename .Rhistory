plotHeight <- 8
makeHetKoPlot <- function(dat.xls){
fcCutOff <- 2
dat.curDat <- getVars(dat.xls)
lab <- c("","RNA splicing", "Cytosolic ribosome","Both")
scPlot <- makeScatterPlot(dat.curDat, lab)
scPlot <- scPlot + xlab("Log2-fold change (KO/WT)") + ylab("Log2-fold change (Het/WT)")
scPlot <- scPlot + geom_text_repel(aes(label=ifelse((((color==1 | color==2) & x> 2) | ((color==1 | color==2) & y > 2)), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
scPlot <- scPlot + coord_cartesian(ylim=c(-5,5), xlim=c(-5,5))
return(scPlot)
}
trio.hetko <- makeHetKoPlot(trio.xls)
trio.hetko
source('~/Google Drive/psp/functions/makeScatterPlot.R', echo=TRUE)
makeHetKoPlot <- function(dat.xls){
fcCutOff <- 2
dat.curDat <- getVars(dat.xls)
lab <- c("","RNA splicing", "Cytosolic ribosome","Both")
scPlot <- makeScatterPlot(dat.curDat, lab)
scPlot <- scPlot + xlab("Log2-fold change (KO/WT)") + ylab("Log2-fold change (Het/WT)")
scPlot <- scPlot + geom_text_repel(aes(label=ifelse((((color==1 | color==2) & x> 2) | ((color==1 | color==2) & y > 2)), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
scPlot <- scPlot + coord_cartesian(ylim=c(-5,5), xlim=c(-5,5))
return(scPlot)
}
trio.hetko <- makeHetKoPlot(trio.xls)
trio.hetko
getVars<-function(dat.xls){
curDat <- dat.xls %>% select(geneSymbol,
logFC.KO.over.WT,
logFC.Het.over.WT,
logFC.KO.over.Het,
spl.ribo,
stressGranule
)
curDat <-  curDat %>% mutate(x=logFC.KO.over.WT, y=logFC.Het.over.WT, color=spl.ribo)
return(curDat)
}
getVars<-function(dat.xls){
curDat <- dat.xls %>% select(geneSymbol,
logFC.KO.over.WT,
logFC.Het.over.WT,
logFC.KO.over.Het,
spl.ribo,
stressGranule
)
curDat <-  curDat %>% mutate(x=logFC.KO.over.WT, y=logFC.Het.over.WT, color=stressGranule)
return(curDat)
}
plotWidth <- 12
plotHeight <- 8
makeHetKoPlot <- function(dat.xls){
fcCutOff <- 2
dat.curDat <- getVars(dat.xls)
lab <- c("","RNA splicing", "Cytosolic ribosome","Both")
scPlot <- makeScatterPlot(dat.curDat, lab)
scPlot <- scPlot + xlab("Log2-fold change (KO/WT)") + ylab("Log2-fold change (Het/WT)")
scPlot <- scPlot + geom_text_repel(aes(label=ifelse((((color==1 | color==2) & x> 2) | ((color==1 | color==2) & y > 2)), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
scPlot <- scPlot + coord_cartesian(ylim=c(-5,5), xlim=c(-5,5))
return(scPlot)
}
trio.hetko <- makeHetKoPlot(trio.xls)
getVars<-function(dat.xls){
curDat <- dat.xls %>% select(geneSymbol,
logFC.KO.over.WT,
logFC.Het.over.WT,
logFC.KO.over.Het,
spl.ribo,
stressGranuleAssembly
)
curDat <-  curDat %>% mutate(x=logFC.KO.over.WT, y=logFC.Het.over.WT, color=stressGranuleAssembly)
return(curDat)
}
plotWidth <- 12
plotHeight <- 8
makeHetKoPlot <- function(dat.xls){
fcCutOff <- 2
dat.curDat <- getVars(dat.xls)
lab <- c("","RNA splicing", "Cytosolic ribosome","Both")
scPlot <- makeScatterPlot(dat.curDat, lab)
scPlot <- scPlot + xlab("Log2-fold change (KO/WT)") + ylab("Log2-fold change (Het/WT)")
scPlot <- scPlot + geom_text_repel(aes(label=ifelse((((color==1 | color==2) & x> 2) | ((color==1 | color==2) & y > 2)), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
scPlot <- scPlot + coord_cartesian(ylim=c(-5,5), xlim=c(-5,5))
return(scPlot)
}
trio.hetko <- makeHetKoPlot(trio.xls)
trio.hetko
pVal <- 0.1
setVars<-function(dat.xls){
dat.xls <- dat.xls %>% drop_na(logFC.WT.over.KO, logFC.WT.over.Het, logFC.KO.over.Het)
dat.xls <- dat.xls %>% mutate(logFC.KO.over.WT = logFC.WT.over.KO*(-1))
dat.xls <- dat.xls %>% mutate(logFC.Het.over.WT = logFC.WT.over.Het*(-1))
dat.xls <- dat.xls %>% mutate(t.KO.over.WT = t.WT.over.KO*(-1))
dat.xls <- dat.xls %>% mutate(t.Het.over.WT = t.WT.over.Het*(-1))
dat.xls <- dat.xls %>% mutate(ko.sig = ifelse(P.Value.WT.over.KO < pVal, 1, 0))
dat.xls <- dat.xls %>% mutate(het.sig = ifelse(P.Value.WT.over.Het < pVal, 2, 0))
dat.xls <- dat.xls %>% mutate(hetOverWT.sig = ifelse(P.Value.WT.over.Het < pVal, 1, 0))
dat.xls <- dat.xls %>% mutate(both.sig = as.factor(ko.sig + het.sig))
dat.xls <- dat.xls %>% mutate(koOverHet.sig = ifelse(P.Value.KO.over.Het < pVal, 2, 0))
dat.xls <- dat.xls %>% mutate(both.koOverHet.sig = as.factor(hetOverWT.sig + koOverHet.sig))
dat.xls <- dat.xls %>% mutate(splicing = ifelse(geneSymbol %in% rnaSplicing, 1, 0))
dat.xls <- dat.xls %>% mutate(cytosolicRibosome = ifelse(geneSymbol %in% cytosolicRibosome, 2, 0))
dat.xls <- dat.xls %>% mutate(spl.ribo = splicing + cytosolicRibosome)
dat.xls <- dat.xls %>% mutate(stressGranuleAssembly = ifelse(geneSymbol %in% granuleGenes, 1, 0))
return (dat.xls)
}
trio.xls <- setVars(trio.xls)
shank3.xls <- setVars(shank3.xls)
grin2a.xls <- setVars(grin2a.xls)
getVars<-function(dat.xls){
curDat <- dat.xls %>% select(geneSymbol,
logFC.KO.over.WT,
logFC.Het.over.WT,
logFC.KO.over.Het,
spl.ribo,
stressGranuleAssembly
)
curDat <-  curDat %>% mutate(x=logFC.KO.over.WT, y=logFC.Het.over.WT, color=stressGranuleAssembly)
return(curDat)
}
plotWidth <- 12
plotHeight <- 8
makeHetKoPlot <- function(dat.xls){
fcCutOff <- 2
dat.curDat <- getVars(dat.xls)
lab <- c("","RNA splicing", "Cytosolic ribosome","Both")
scPlot <- makeScatterPlot(dat.curDat, lab)
scPlot <- scPlot + xlab("Log2-fold change (KO/WT)") + ylab("Log2-fold change (Het/WT)")
scPlot <- scPlot + geom_text_repel(aes(label=ifelse((((color==1 | color==2) & x> 2) | ((color==1 | color==2) & y > 2)), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
scPlot <- scPlot + coord_cartesian(ylim=c(-5,5), xlim=c(-5,5))
return(scPlot)
}
trio.hetko <- makeHetKoPlot(trio.xls)
trio.hetko
grin2a.hetko <- makeHetKoPlot(grin2a.xls)
grin2a.hetko
shank3.hetko <- makeHetKoPlot(shank3.xls)
shank3.hetko
getVars<-function(dat.xls){
curDat <- dat.xls %>% select(geneSymbol,
logFC.KO.over.WT,
logFC.Het.over.WT,
logFC.KO.over.Het,
spl.ribo,
#stressGranuleAssembly
)
curDat <-  curDat %>% mutate(x=logFC.KO.over.WT, y=logFC.Het.over.WT, color=spl.ribo)
return(curDat)
}
plotWidth <- 12
makeHetKoPlot <- function(dat.xls){
fcCutOff <- 2
dat.curDat <- getVars(dat.xls)
lab <- c("","RNA splicing", "Cytosolic ribosome","Both")
scPlot <- makeScatterPlot(dat.curDat, lab)
scPlot <- scPlot + xlab("Log2-fold change (KO/WT)") + ylab("Log2-fold change (Het/WT)")
scPlot <- scPlot + geom_text_repel(aes(label=ifelse((((color==1 | color==2) & x> 2) | ((color==1 | color==2) & y > 2)), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
scPlot <- scPlot + coord_cartesian(ylim=c(-5,5), xlim=c(-5,5))
return(scPlot)
}
trio.hetko <- makeHetKoPlot(trio.xls)
trio.hetko
all.xls <- full_join(grin2a.xls, shank3.xls, by="id", suffix=c(".grin2a", ".shank3"))
all.xls <- full_join(grin2a.xls, shank3.xls, by="id", suffix=c(".grin2a", ".shank3"))
all.xls <- full_join(all.xls, trio.xls, by="id")
schemaGenes <- as.factor(c("Setd1a", "Cul1", "Xpo7", "Trio", "Cacna1g", "Sp4", "Gria3", "Grin2a", "Herc1", "Rb1cc1", "Hcn4", "Akap11", "Znf136", "Srrm2", "Nr3c2", "Srsf7"))
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% c("Srrm2", "Rbm25")
)
all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% c("Srrm2", "Rbm25"))
all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol.grin2a %in% c("Srrm2", "Rbm25"))
all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol.shank3 %in% c("Srrm2", "Rbm25"))
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes <- c("Srrm2", "Srrm1", "Rbm25", "Son", "Coil", "Pnn", "Prpf8")
all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes <- c("Srrm2", "Srrm1", "Rbm25", "Son", "Coil", "Pnn", "Prpf8". "Prp8")
schemaGenes <- c("Srrm2", "Srrm1", "Rbm25", "Son", "Coil", "Pnn", "Prpf8", "Prp8")
all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
pathways.go$GO_SPLICEOSOMAL_COMPLEX
pathways.go$GO_RNA_SPLICING
pathways.go$GO_STRESS_GRANULE_DISASSEMBLY
pathways.go$GO_STRESS_GRANULE_ASSEMBLY
pathways.go$GO_P_BODY
pathways.go$GO_P_BODY_ASSEMBLY
pathways.go$GO_P_BODY
tst.koOverWt <- 't.KO.over.WT'
tst.hetOverWt <- 't.Het.over.WT'
tst.koOverHet <- 't.KO.over.Het'
getGoAnalyses <- function(dat){
dat.koOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverWt)
dat.hetOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.hetOverWt)
dat.koOverHet.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverHet)
dat.go <- inner_join(dat.koOverWt.go, dat.hetOverWt.go, by="pathway")
dat.go <- inner_join(dat.go, dat.koOverHet.go, by="pathway")
return(dat.go)
}
grin2a.go <- getGoAnalyses(grin2a.xls)
tst.koOverWt <- 't.KO.over.WT'
tst.koOverWt <- 't.KO.over.WT'
tst.hetOverWt <- 't.Het.over.WT'
tst.koOverHet <- 't.KO.over.Het'
getGoAnalyses <- function(dat){
dat.koOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverWt)
dat.hetOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.hetOverWt)
dat.koOverHet.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverHet)
dat.go <- inner_join(dat.koOverWt.go, dat.hetOverWt.go, by="pathway")
dat.go <- inner_join(dat.go, dat.koOverHet.go, by="pathway")
return(dat.go)
}
grin2a.go <- getGoAnalyses(grin2a.xls)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
grin2a.go <- getGoAnalyses(grin2a.xls)
shank3.go <- getGoAnalyses(shank3.xls)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
grin2a.go <- getGoAnalyses(grin2a.xls)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
getGoAnalyses <- function(dat){
dat.koOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverWt)
dat.hetOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.hetOverWt)
dat.koOverHet.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverHet)
dat.go <- inner_join(dat.koOverWt.go, dat.hetOverWt.go, by="pathway")
dat.go <- inner_join(dat.go, dat.koOverHet.go, by="pathway")
return(dat.go)
}
grin2a.go <- getGoAnalyses(grin2a.xls)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
getGoAnalyses <- function(dat){
dat.koOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverWt)
dat.hetOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.hetOverWt)
dat.koOverHet.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverHet)
dat.go <- inner_join(dat.koOverWt.go, dat.hetOverWt.go, by="pathway")
dat.go <- inner_join(dat.go, dat.koOverHet.go, by="pathway")
return(dat.go)
}
grin2a.go <- getGoAnalyses(grin2a.xls)
debug(doGoAnalysis)
grin2a.go <- getGoAnalyses(grin2a.xls)
tStat
typeof(tStat)
res %>% select(tStat)
sa<-res %>% select(tStat)
head(sa)
sa
?as.name
# Load data and libraries
rm(list=ls())
require(readxl)
require(tidyverse)
require(tm)
require(ggfortify)
require(PCAtools)
require(reshape2)
require(ggbeeswarm)
require(EnhancedVolcano)
require(RColorBrewer)
require(fgsea)
require(ComplexHeatmap)
files.sources = list.files("../functions" , full.names = TRUE)
invisible(lapply(files.sources, source))
trio.xls <- read_xlsx("../data/results_PSD-Trio-proteome_Two-sample_mod_T_2020-07-24.xlsx")
shank3.xls <- read_xlsx("../data/results_PSD-Shank3-proteome_Two-sample_mod_T_2020-07-22.xlsx")
grin2a.xls <- read_xlsx("../data/results_Glun2a-TMT16-Proteome_Two-sample_mod_T_2020-11-30.xlsx")
rna.grin2a.het <- read_csv("../data/HP_HTWT-DESeq2_102020.csv")
rna.grin2a.hom <- read_csv("../data/HP_HHWT-DESeq2_102020.csv")
goPathways <- "~/Google Drive/geneSets/mSigDb/v7_2/ontology/c5.all.v7.2.symbols.gmt"
pathways.go <- gmtPathways(goPathways)
rnaSplicing <- str_to_title(pathways.go$GO_RNA_SPLICING)
cytosolicRibosome <- str_to_title(pathways.go$GO_CYTOSOLIC_RIBOSOME)
stressGranAs <- str_to_title(pathways.go$GO_STRESS_GRANULE_ASSEMBLY)
# shank3.xls <- shank3.xls %>% filter(Shank3_PSD_TMT11_Proteome.numSpectra > 5)
# trio.xls <- trio.xls %>% filter(Trio_PSD_TMT11_Proteome.numSpectra > 5)
# grin2a.xls <- grin2a.xls %>% filter(Glun2A_PSD_TMT16_Proteome.numSpectra > 5)
pVal <- 0.1
setVars<-function(dat.xls){
dat.xls <- dat.xls %>% drop_na(logFC.WT.over.KO, logFC.WT.over.Het, logFC.KO.over.Het)
dat.xls <- dat.xls %>% mutate(logFC.KO.over.WT = logFC.WT.over.KO*(-1))
dat.xls <- dat.xls %>% mutate(logFC.Het.over.WT = logFC.WT.over.Het*(-1))
dat.xls <- dat.xls %>% mutate(t.KO.over.WT = t.WT.over.KO*(-1))
dat.xls <- dat.xls %>% mutate(t.Het.over.WT = t.WT.over.Het*(-1))
dat.xls <- dat.xls %>% mutate(ko.sig = ifelse(P.Value.WT.over.KO < pVal, 1, 0))
dat.xls <- dat.xls %>% mutate(het.sig = ifelse(P.Value.WT.over.Het < pVal, 2, 0))
dat.xls <- dat.xls %>% mutate(hetOverWT.sig = ifelse(P.Value.WT.over.Het < pVal, 1, 0))
dat.xls <- dat.xls %>% mutate(both.sig = as.factor(ko.sig + het.sig))
dat.xls <- dat.xls %>% mutate(koOverHet.sig = ifelse(P.Value.KO.over.Het < pVal, 2, 0))
dat.xls <- dat.xls %>% mutate(both.koOverHet.sig = as.factor(hetOverWT.sig + koOverHet.sig))
dat.xls <- dat.xls %>% mutate(splicing = ifelse(geneSymbol %in% rnaSplicing, 1, 0))
dat.xls <- dat.xls %>% mutate(cytosolicRibosome = ifelse(geneSymbol %in% cytosolicRibosome, 2, 0))
dat.xls <- dat.xls %>% mutate(spl.ribo = splicing + cytosolicRibosome)
dat.xls <- dat.xls %>% mutate(stressGranuleAssembly = ifelse(geneSymbol %in% granuleGenes, 1, 0))
return (dat.xls)
}
trio.xls <- setVars(trio.xls)
pVal <- 0.1
setVars<-function(dat.xls){
dat.xls <- dat.xls %>% drop_na(logFC.WT.over.KO, logFC.WT.over.Het, logFC.KO.over.Het)
dat.xls <- dat.xls %>% mutate(logFC.KO.over.WT = logFC.WT.over.KO*(-1))
dat.xls <- dat.xls %>% mutate(logFC.Het.over.WT = logFC.WT.over.Het*(-1))
dat.xls <- dat.xls %>% mutate(t.KO.over.WT = t.WT.over.KO*(-1))
dat.xls <- dat.xls %>% mutate(t.Het.over.WT = t.WT.over.Het*(-1))
dat.xls <- dat.xls %>% mutate(ko.sig = ifelse(P.Value.WT.over.KO < pVal, 1, 0))
dat.xls <- dat.xls %>% mutate(het.sig = ifelse(P.Value.WT.over.Het < pVal, 2, 0))
dat.xls <- dat.xls %>% mutate(hetOverWT.sig = ifelse(P.Value.WT.over.Het < pVal, 1, 0))
dat.xls <- dat.xls %>% mutate(both.sig = as.factor(ko.sig + het.sig))
dat.xls <- dat.xls %>% mutate(koOverHet.sig = ifelse(P.Value.KO.over.Het < pVal, 2, 0))
dat.xls <- dat.xls %>% mutate(both.koOverHet.sig = as.factor(hetOverWT.sig + koOverHet.sig))
dat.xls <- dat.xls %>% mutate(splicing = ifelse(geneSymbol %in% rnaSplicing, 1, 0))
dat.xls <- dat.xls %>% mutate(cytosolicRibosome = ifelse(geneSymbol %in% cytosolicRibosome, 2, 0))
dat.xls <- dat.xls %>% mutate(spl.ribo = splicing + cytosolicRibosome)
#dat.xls <- dat.xls %>% mutate(stressGranuleAssembly = ifelse(geneSymbol %in% granuleGenes, 1, 0))
return (dat.xls)
}
trio.xls <- setVars(trio.xls)
shank3.xls <- setVars(shank3.xls)
grin2a.xls <- setVars(grin2a.xls)
getVars<-function(dat.xls){
curDat <- dat.xls %>% select(geneSymbol,
logFC.KO.over.WT,
logFC.Het.over.WT,
logFC.KO.over.Het,
ko.sig, het.sig, both.sig)
curDat <-  curDat %>% mutate(x=logFC.KO.over.WT, y=logFC.Het.over.WT, color=both.sig)
return(curDat)
}
plotWidth <- 12
plotHeight <- 8
tst.koOverWt <- 't.KO.over.WT'
tst.hetOverWt <- 't.Het.over.WT'
tst.koOverHet <- 't.KO.over.Het'
getGoAnalyses <- function(dat){
dat.koOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverWt)
dat.hetOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.hetOverWt)
dat.koOverHet.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverHet)
dat.go <- inner_join(dat.koOverWt.go, dat.hetOverWt.go, by="pathway")
dat.go <- inner_join(dat.go, dat.koOverHet.go, by="pathway")
return(dat.go)
}
grin2a.go <- getGoAnalyses(grin2a.xls)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
grin2a.go <- getGoAnalyses(grin2a.xls)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
grin2a.go <- getGoAnalyses(grin2a.xls)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
grin2a.go <- getGoAnalyses(grin2a.xls)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
grin2a.go <- getGoAnalyses(grin2a.xls)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
grin2a.go <- getGoAnalyses(grin2a.xls)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
grin2a.go <- getGoAnalyses(grin2a.xls)
tStat <- as.name(tStat)
source('~/Google Drive/psp/functions/doGoAnalysis.R', echo=TRUE)
grin2a.go <- getGoAnalyses(grin2a.xls)
dplyr::rename()
?dplyr::rename()
2^0.3
2^0.5
all.xls <- full_join(grin2a.xls, shank3.xls, by="id", suffix=c(".grin2a", ".shank3"))
all.xls <- full_join(all.xls, trio.xls, by="id")
schemaGenes <- as.factor(c("Setd1a", "Cul1", "Xpo7", "Trio", "Cacna1g", "Sp4", "Gria3", "Grin2a", "Herc1", "Rb1cc1", "Hcn4", "Akap11", "Znf136", "Srrm2", "Nr3c2"))
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes <- c("Tia1")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes.xls
schemaGenes.xls
schemaGenes <- c("Tia1", "Sqstm1")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes <- c("Tia1", "Sqstm1", "Tial1")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes <- c("Tia1", "Sqstm1", "Tial1", "G3bp1", "G3bp2")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes <- c("Tia1", "Sqstm1", "Tial1", "G3bp1", "G3bp2", "Fmr1")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes <- c("Tia1", "Sqstm1", "Tial1", "G3bp1", "G3bp2", "Fmr1", "Rbfox2")
schemaGenes.xls
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes <- c("Tia1", "Sqstm1", "Tial1", "G3bp1", "G3bp2", "Fmr1", "Rbfox2", "Matr3")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes <- c("Tia1", "Sqstm1", "Tial1", "G3bp1", "G3bp2", "Fmr1", "Rbfox2", "Matr3", Htt)
schemaGenes <- c("Tia1", "Sqstm1", "Tial1", "G3bp1", "G3bp2", "Fmr1", "Rbfox2", "Matr3", "Htt")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes <- c("Tia1", "Sqstm1", "Tial1", "G3bp1", "G3bp2", "Fmr1", "Rbfox2", "Matr3", "Htt", "Ptbp1")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes <- c("Tia1", "Sqstm1", "Tial1", "G3bp1", "G3bp2", "Fmr1", "Rbfox2", "Matr3", "Htt", "Ptbp1", "Eif2b5")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes <- c("Tia1", "Sqstm1", "Tial1", "G3bp1", "G3bp2", "Fmr1", "Rbfox2", "Matr3", "Htt", "Ptbp1", "Eif2b5", "Pabpc1")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes <- c("Tia1", "Sqstm1", "Tial1", "G3bp1", "G3bp2", "Fmr1", "Rbfox2", "Matr3", "Htt", "Ptbp1", "Eif2b5", "Pabpc1")
schemaGenes.xls
schemaGenes <- c("Pabpc1", "Srsf9")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes <- c("Pabpc1", "Srsf7")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
schemaGenes <- c("Pabpc1", "Srsf10")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
all.xls %>% select(geneSymbol) %>% filter(starts_with("Srsf"))
all.xls %>% select(geneSymbol) %>% starts_with("Srsf")
all.xls %>% select(geneSymbol) %>% starts_with(,"Srsf")
all.xls %>% select(geneSymbol) %>% starts_with(.,"Srsf")
all.xls %>% filter(starts_with(geneSymbol, "Srsf"))
schemaGenes <- c("Pabpc1", "Srsf10", "Ddx3x")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes
schemaGenes.xls
schemaGenes <- c("Pabpc1", "Srsf10", "Ddx3x", "Ubap2l")
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)
schemaGenes.xls
rm(list=ls())
require(DESeq2)
require(naturalsort)
require(RColorBrewer)
require(pheatmap)
require(tidyverse)
require(dplyr)
require(svglite)
require(EnhancedVolcano)
require(fgsea)
trap.sns.info <- read_csv("~/Google Drive (sa3189@nyu.edu)/newDesktop/dtrap/d1/dge/ip_d1_only/DGE-DESeq2-unstr-11samples/input.groups.csv")
total.sns.info <- read_csv("~/Google Drive (sa3189@nyu.edu)/newDesktop/dtrap/d1/dge/total_d1_only/DGE-DESeq2-unstr-11samples/input.groups.csv")
sample.info <- read_csv("~/Google Drive (sa3189@nyu.edu)/newDesktop/dtrap/ip_CORRECTED_sampleSheet.csv")
trap.id <- sample.info %>% filter(sample_ID %in% trap.sns.info$`#SAMPLE`)
trap.id$label <- factor(paste(trap.id$trap_driver, trap.id$genotype, sep="_"), levels=c("D1_WT", "D1_KO"))
#trap.id$
total.id <- sample.info %>% filter(sample_ID %in% total.sns.info$`#SAMPLE`)
total.id$label <- factor(paste(total.id$trap_driver, total.id$genotype, sep="_"), levels=c("D1_WT", "D1_KO"))
all.id <- bind_rows(trap.id, total.id)
all.id$assay <- c(rep("ip",11), rep("total",11))
all.id$label <- factor(all.id$label, levels=c("D1_WT", "D1_KO"))
trap.counts <-read.csv("~/Google Drive (sa3189@nyu.edu)/newDesktop/dtrap/d1/dge/ip_d1_only/DGE-DESeq2-unstr-11samples/counts.raw.csv", row.names=1)
trap.counts<- trap.counts[,naturalorder(colnames(trap.counts))]
total.counts <-read.csv("~/Google Drive (sa3189@nyu.edu)/newDesktop/dtrap/d1/dge/total_d1_only/DGE-DESeq2-unstr-11samples/counts.raw.csv", row.names=1)
total.counts<- total.counts[,naturalorder(colnames(total.counts))]
dds.trap <- DESeqDataSetFromMatrix(countData=as.matrix(trap.counts),
colData=trap.id,
design=~label)
keep.trap <-  rowSums(fpm(dds.trap)>1) >= (dim(dds.trap)[2]-1)
dds.trap <- dds.trap[keep.trap,]
dim(dds.trap)
dds.total <- DESeqDataSetFromMatrix(countData=as.matrix(total.counts),
colData=total.id,
design=~label)
keep.total <- rowSums(fpm(dds.total)>1) >= (dim(dds.total)[2]-1)
dds.total <- dds.total[keep.total,]
dim(dds.total)
dds.trap <- DESeq(dds.trap)
dds.total <- DESeq(dds.total)
pVal <- 0.1
processDeSeq2results <- function(res){
res_tmp <- res[!is.na(res$padj) & !is.na(res$log2FoldChange),]
res_sig <- res_tmp[(res_tmp$padj<pVal),]
res_sig <- res_sig[order(res_sig$padj),]
return (res_sig)
}
res.trap <- results(dds.trap, name = "label_D1_KO_vs_D1_WT")
write.csv(res.trap, file="~/Google Drive (sa3189@nyu.edu)/newDesktop/dtrap/d1/dge/deseq2/IP_D1_KO_vs_IP_D1_WT.csv", quote=FALSE)
cntrst=c("label","D1_KO", "D1_WT")
res.trap.shrunk <- lfcShrink(dds.trap, coef = "label_D1_KO_vs_D1_WT", res=res.trap)
res.trap.shrunk <- res.trap.shrunk[order(res.trap.shrunk$padj),]
summary(res.trap.shrunk)
write.csv(res.trap.shrunk, file="~/Google Drive (sa3189@nyu.edu)/newDesktop/dtrap/d1/dge/deseq2/IP_D1_KO_vs_IP_D1_WT_SHRUNK.csv", quote=FALSE)
res.trap.sig <- processDeSeq2results(res.trap.shrunk)
summary(res.trap.sig)
write.csv(res.trap.sig, file="~/Google Drive (sa3189@nyu.edu)/newDesktop/dtrap/d1/dge/deseq2/IP_D1_KO_vs_IP_D1_WT.q01.csv", quote=FALSE)
res.total <- results(dds.total, name = "label_D1_KO_vs_D1_WT")
write.csv(res.total, file="~/Google Drive (sa3189@nyu.edu)/newDesktop/dtrap/d1/dge/deseq2/Total_D1_KO_vs_Total_D1_WT.csv", quote=FALSE)
res.total.shrunk <- lfcShrink(dds.total, coef= "label_D1_KO_vs_D1_WT", res=res.total)
res.total.shrunk <- res.total.shrunk[order(res.total.shrunk$padj),]
summary(res.total.shrunk)
write.csv(res.total.shrunk, file="~/Google Drive (sa3189@nyu.edu)/newDesktop/dtrap/d1/dge/deseq2/Total_D1_KO_vs_Total_D1_WT_SHRUNK.csv", quote=FALSE)
res.total.sig <- processDeSeq2results(res.total.shrunk)
summary(res.total.sig, )
write.csv(res.total.sig, file="~/Google Drive (sa3189@nyu.edu)/newDesktop/dtrap/d1/dge/deseq2/Total_D1_KO_vs_Total_D1_WT.q01.csv", quote=FALSE)
head(res.trap)
hed(res.total)
head(res.total)
cor(res.trap, res.total)
sa<-inner_join(res.trap, res.total)
cor(res.trap$log2FoldChange, res.total$log2FoldChange)
res.trap$log2FoldChange
merge(res.trap, res.total)
?merge
head(res.trap)
head(res.total)
merge(as.data.frame(res.trap), as.data.frame(res.total))
as.data.frame(res.trap)
merge(as.data.frame(res.trap), as.data.frame(res.total))
as.data.frame(res.total)
sa<-as.data.frame(res.trap)
sb<-as.data.frame(res.total)
merge(sa,sb)
head(sa)
head(sb)
sa$geneSymbol <- rownames(sa)
sb$geneSymbol <- rownames(sb)
sc<-inner_join(sa, sb, by="geneSymbol")
head(sc)
dim(sc)
cor(sc$log2FoldChange.x, sc$log2FoldChange.y)
