---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 
```{r}
# Load data and libraries
rm(list=ls())
require(readxl)
require(tidyverse)
require(tm)
require(ggfortify)
require(PCAtools)
require(reshape2)
require(ggbeeswarm)
require(EnhancedVolcano)
require(RColorBrewer)
require(fgsea)
require(ComplexHeatmap)
files.sources = list.files("../functions" , full.names = TRUE)
invisible(lapply(files.sources, source))
```

```{r}
trio.xls <- read_xlsx("../data/results_PSD-Trio-proteome_Two-sample_mod_T_2020-07-24.xlsx")
shank3.xls <- read_xlsx("../data/results_PSD-Shank3-proteome_Two-sample_mod_T_2020-07-22.xlsx")
grin2a.xls <- read_xlsx("../data/results_Glun2a-TMT16-Proteome_Two-sample_mod_T_2020-11-30.xlsx")
rna.grin2a.het <- read_csv("../data/HP_HTWT-DESeq2_102020.csv")
rna.grin2a.hom <- read_csv("../data/HP_HHWT-DESeq2_102020.csv")
goPathways <- "~/Google Drive/geneSets/mSigDb/v7_2/ontology/c5.all.v7.2.symbols.gmt"
pathways.go <- gmtPathways(goPathways)
rnaSplicing <- str_to_title(pathways.go$GO_RNA_SPLICING)
cytosolicRibosome <- str_to_title(pathways.go$GO_CYTOSOLIC_RIBOSOME)
stressGranAs <- str_to_title(pathways.go$GO_STRESS_GRANULE_ASSEMBLY)
# shank3.xls <- shank3.xls %>% filter(Shank3_PSD_TMT11_Proteome.numSpectra > 5)
# trio.xls <- trio.xls %>% filter(Trio_PSD_TMT11_Proteome.numSpectra > 5)
# grin2a.xls <- grin2a.xls %>% filter(Glun2A_PSD_TMT16_Proteome.numSpectra > 5)

```

```{r}
pVal <- 0.1

setVars<-function(dat.xls){
  dat.xls <- dat.xls %>% drop_na(logFC.WT.over.KO, logFC.WT.over.Het, logFC.KO.over.Het)
  dat.xls <- dat.xls %>% mutate(logFC.KO.over.WT = logFC.WT.over.KO*(-1))
  dat.xls <- dat.xls %>% mutate(logFC.Het.over.WT = logFC.WT.over.Het*(-1))
  dat.xls <- dat.xls %>% mutate(t.KO.over.WT = t.WT.over.KO*(-1))
  dat.xls <- dat.xls %>% mutate(t.Het.over.WT = t.WT.over.Het*(-1))
  dat.xls <- dat.xls %>% mutate(ko.sig = ifelse(P.Value.WT.over.KO < pVal, 1, 0))
  dat.xls <- dat.xls %>% mutate(het.sig = ifelse(P.Value.WT.over.Het < pVal, 2, 0))
  dat.xls <- dat.xls %>% mutate(hetOverWT.sig = ifelse(P.Value.WT.over.Het < pVal, 1, 0))
  dat.xls <- dat.xls %>% mutate(both.sig = as.factor(ko.sig + het.sig))
  dat.xls <- dat.xls %>% mutate(koOverHet.sig = ifelse(P.Value.KO.over.Het < pVal, 2, 0))
  dat.xls <- dat.xls %>% mutate(both.koOverHet.sig = as.factor(hetOverWT.sig + koOverHet.sig))
  dat.xls <- dat.xls %>% mutate(splicing = ifelse(geneSymbol %in% rnaSplicing, 1, 0))
  dat.xls <- dat.xls %>% mutate(cytosolicRibosome = ifelse(geneSymbol %in% cytosolicRibosome, 2, 0))
  dat.xls <- dat.xls %>% mutate(spl.ribo = splicing + cytosolicRibosome)
  #dat.xls <- dat.xls %>% mutate(stressGranuleAssembly = ifelse(geneSymbol %in% granuleGenes, 1, 0))
  return (dat.xls)
}

trio.xls <- setVars(trio.xls)
shank3.xls <- setVars(shank3.xls)
grin2a.xls <- setVars(grin2a.xls)
```

```{r}
getVars<-function(dat.xls){
  curDat <- dat.xls %>% select(geneSymbol, 
                             logFC.KO.over.WT, 
                             logFC.Het.over.WT,
                             logFC.KO.over.Het, 
                             ko.sig, het.sig, both.sig)
  curDat <-  curDat %>% mutate(x=logFC.KO.over.WT, y=logFC.Het.over.WT, color=both.sig)
  return(curDat)
}

plotWidth <- 12
plotHeight <- 8

```


```{r}

makeHetKoPlot <- function(dat.xls){
  fcCutOff <- 3
  dat.curDat <- getVars(dat.xls)
  lab  <- c("NS", "Sig. KO/WT", "Sig. Het/WT", "Sig. Both")
  scPlot <- makeScatterPlot(dat.curDat, lab)
  scPlot <- scPlot + xlab("Log2-fold change (KO/WT)") + ylab("Log2-fold change (Het/WT)")
  scPlot <- scPlot + geom_text_repel(aes(label=ifelse((color==3 & (x > fcCutOff | x < -fcCutOff | y > fcCutOff | y < -fcCutOff)),
                                                      as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black',
                                                      segment.size = .5, segment.alpha = .25)
    scPlot <- scPlot + geom_text_repel(aes(label=ifelse(((color==1 | color==2) & (x< -5 | x>5 | y< -5 | y>5)), as.character(geneSymbol), '')), 
                                       show.legend = FALSE, 
                                       segment.color='black', 
                                       segment.size = .5, 
                                       segment.alpha = .25)
  
  scPlot <- scPlot + coord_cartesian(ylim=c(-7,7), xlim=c(-7,7))
  return(scPlot)
}

trio.hetko <- makeHetKoPlot(trio.xls)
ggsave(plot = trio.hetko, "~/Google Drive/psp/analysis/plots/trio/lfcScatter_ko_v_het.pdf", width = plotWidth, height = plotHeight, units = "in")

shank3.hetko <- makeHetKoPlot(shank3.xls)
ggsave(plot = shank3.hetko, "~/Google Drive/psp/analysis/plots/shank3/lfcScatter_ko_v_het.pdf", width = plotWidth, height = plotHeight, units = "in")

grin2a.hetko <- makeHetKoPlot(grin2a.xls)
ggsave(plot = grin2a.hetko, "~/Google Drive/psp/analysis/plots/grin2a/lfcScatter_ko_v_het.pdf", width = plotWidth, height = plotHeight, units = "in")


```

```{r}
getVars<-function(dat.xls){
  curDat <- dat.xls %>% select(geneSymbol, 
                             logFC.KO.over.WT, 
                             logFC.Het.over.WT,
                             logFC.KO.over.Het, 
                             ko.sig, het.sig, both.koOverHet.sig)
  curDat <-  curDat %>% mutate(x=logFC.Het.over.WT, y=logFC.KO.over.Het, color=both.koOverHet.sig)
  return(curDat)
}

plotWidth <- 12
plotHeight <- 8

```
```{r}
makeKoHetPlot <- function(dat.xls){
  fcCutOff <- 2
  limCut <- 5
  dat.curDat <- getVars(dat.xls)
  lab  <- c("NS", "Sig. Het/WT", "Sig. KO/Het", "Sig. Both")
  scPlot <- makeScatterPlot(dat.curDat, lab)
  scPlot <- scPlot + xlab("Log2-fold change (Het/WT)") + ylab("Log2-fold change (KO/Het)")
  scPlot <- scPlot + geom_text_repel(aes(label=ifelse((color==3 & (x > fcCutOff | x < -fcCutOff | y > fcCutOff | y < -fcCutOff)), as.character(geneSymbol), '')), 
                                     show.legend = FALSE, segment.color='black',
                                     segment.size = .5,
                                     segment.alpha = .25)
   scPlot <- scPlot + geom_text_repel(aes(label=ifelse(((color==1 | color==2) & (x< -5 | x>5 | y< -5 | y>5)), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25)
  
 scPlot <- scPlot + coord_cartesian(ylim=c(-limCut,limCut), xlim=c(-limCut,limCut))
  return(scPlot)
}

trio.kohet <- makeKoHetPlot(trio.xls)
ggsave(plot = trio.kohet, "~/Google Drive/psp/analysis/plots/trio/lfcScatter_hetWt_v_koHet.pdf", width = plotWidth, height = plotHeight, units = "in")

shank3.kohet <- makeKoHetPlot(shank3.xls)
ggsave(plot = shank3.kohet, "~/Google Drive/psp/analysis/plots/shank3/lfcScatter_hetWt_v_koHet.pdf", width = plotWidth, height = plotHeight, units = "in")

grin2a.kohet <- makeKoHetPlot(grin2a.xls)
ggsave(plot = grin2a.kohet, "~/Google Drive/psp/analysis/plots/grin2a/lfcScatter_hetWt_v_koHet.pdf", width = plotWidth, height = plotHeight, units = "in")

```




```{r}
getVars<-function(dat.xls){
  curDat <- dat.xls %>% select(geneSymbol, 
                             logFC.KO.over.WT, 
                             logFC.Het.over.WT,
                             logFC.KO.over.Het,
                             spl.ribo,
                             #stressGranuleAssembly
                             )
  curDat <-  curDat %>% mutate(x=logFC.KO.over.WT, y=logFC.Het.over.WT, color=spl.ribo)
  return(curDat)
}

plotWidth <- 12
plotHeight <- 8

makeHetKoPlot <- function(dat.xls){
  fcCutOff <- 2
  dat.curDat <- getVars(dat.xls)
  lab <- c("","RNA splicing", "Cytosolic ribosome","Both")
  scPlot <- makeScatterPlot(dat.curDat, lab)
  scPlot <- scPlot + xlab("Log2-fold change (KO/WT)") + ylab("Log2-fold change (Het/WT)")
  scPlot <- scPlot + geom_text_repel(aes(label=ifelse((((color==1 | color==2) & x> 2) | ((color==1 | color==2) & y > 2)), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
  scPlot <- scPlot + coord_cartesian(ylim=c(-5,5), xlim=c(-5,5))
  return(scPlot)
}

trio.hetko <- makeHetKoPlot(trio.xls)
ggsave(plot = trio.hetko, "~/Google Drive/psp/analysis/plots/trio/lfcScatter_ko_v_het_Splicing_Ribosome.pdf", width = plotWidth, height = plotHeight, units = "in")

shank3.hetko <- makeHetKoPlot(shank3.xls)
ggsave(plot = shank3.hetko, "~/Google Drive/psp/analysis/plots/shank3/lfcScatter_ko_v_het_Splicing_Ribosome.pdf", width = plotWidth, height = plotHeight, units = "in")

grin2a.hetko <- makeHetKoPlot(grin2a.xls)
ggsave(plot = grin2a.hetko, "~/Google Drive/psp/analysis/plots/grin2a/lfcScatter_ko_v_het_Splicing_Ribosome.pdf", width = plotWidth, height = plotHeight, units = "in")
```

```{r}
getVars<-function(dat.xls){
  curDat <- dat.xls %>% select(geneSymbol, 
                             logFC.KO.over.WT, 
                             logFC.Het.over.WT,
                             logFC.KO.over.Het,
                             spl.ribo
                             )
  curDat <-  curDat %>% mutate(x=logFC.Het.over.WT, y=logFC.KO.over.Het, color=spl.ribo)
  return(curDat)
}

plotWidth <- 12
plotHeight <- 8

makeHetKoPlot <- function(dat.xls){
  fcCutOff <- 2
  dat.curDat <- getVars(dat.xls)
  lab <- c("","RNA splicing", "Cytosolic ribosome","Both")
  scPlot <- makeScatterPlot(dat.curDat, lab)
  scPlot <- scPlot + xlab("Log2-fold change (Het/WT)") + ylab("Log2-fold change (KO/Het)")
  scPlot <- scPlot + geom_text_repel(aes(label=ifelse((((color==1 | color==2) & x> 2) | ((color==1 | color==2) & y > 2)), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
  scPlot <- scPlot + coord_cartesian(ylim=c(-5,5), xlim=c(-5,5))
  return(scPlot)
}

trio.hetko <- makeHetKoPlot(trio.xls)
ggsave(plot = trio.hetko, "~/Google Drive/psp/analysis/plots/trio/lfcScatter_hetWt_v_koHet_Splicing_Ribosome.pdf", width = plotWidth, height = plotHeight, units = "in")

shank3.hetko <- makeHetKoPlot(shank3.xls)
ggsave(plot = shank3.hetko, "~/Google Drive/psp/analysis/plots/shank3/lfcScatter_hetWt_v_koHet_Splicing_Ribosome.pdf", width = plotWidth, height = plotHeight, units = "in")

grin2a.hetko <- makeHetKoPlot(grin2a.xls)
ggsave(plot = grin2a.hetko, "~/Google Drive/psp/analysis/plots/grin2a/lfcScatter_hetWt_v_koHet_Splicing_Ribosome.pdf", width = plotWidth, height = plotHeight, units = "in")


```


```{r}
tst.koOverWt <- 't.KO.over.WT'
tst.hetOverWt <- 't.Het.over.WT'
tst.koOverHet <- 't.KO.over.Het'

getGoAnalyses <- function(dat){
  dat.koOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverWt)
  dat.hetOverWt.go <- doGoAnalysis(dat, goPathways, tStat=tst.hetOverWt)
  dat.koOverHet.go <- doGoAnalysis(dat, goPathways, tStat=tst.koOverHet)

  dat.go <- inner_join(dat.koOverWt.go, dat.hetOverWt.go, by="pathway")
  dat.go <- inner_join(dat.go, dat.koOverHet.go, by="pathway")
  return(dat.go)
}

grin2a.go <- getGoAnalyses(grin2a.xls)
shank3.go <- getGoAnalyses(shank3.xls)
trio.go <- getGoAnalyses(trio.xls) 
```
```{r}
setGoScatter <- function(dat.go){
  pVal = 10e-3
  dat.go <- dat.go %>% mutate(koOverWt.sig = ifelse(padj.x < pVal, 1, 0))
  dat.go <- dat.go %>% mutate(hetOverWt.sig = ifelse(padj.y < pVal, 2, 0))
  dat.go <- dat.go %>% mutate(both.sig = as.factor(koOverWt.sig + hetOverWt.sig))
  dat.go <- dat.go %>% mutate(X=NES.x, Y=NES.y)
  dat.go <- dat.go %>% mutate(color=both.sig)
  return (dat.go)
}

getGoScatter <- function(dat.go){
  sa <- dat.go %>% select(pathway, X, Y, color)
  sa <- na.omit(sa)
  lab  <- c("NS", "Sig. KO/WT", "Sig. Het/WT", "Sig. Both")
  koOverWtVhetOverWt.go.plot <- plotGoScatter(sa, lab)
  koOverWtVhetOverWt.go.plot <- koOverWtVhetOverWt.go.plot + xlab("Normalized Enrichment Score (KO/WT)") + ylab("Normalized Enrichment Score (Het/WT)")
  return(koOverWtVhetOverWt.go.plot)
}

```

```{r}
plotWidth <- 15
plotHeight <- (6/8)*plotWidth
grin2a.go <- setGoScatter(grin2a.go)
grin2a.go.scatter <- getGoScatter(grin2a.go)
# ggsave(plot = grin2a.go.scatter, "~/Google Drive/psp/analysis/plots/grin2a/goScatter_koOverWt_v_hetOverWt.pdf", width = plotWidth, height = plotHeight, units = "in")
grin2a.go.scatter <- grin2a.go.scatter + coord_cartesian(xlim=c(0,3), ylim = c(0,3))
ggsave(plot = grin2a.go.scatter, "~/Google Drive/psp/analysis/plots/grin2a/goScatter_koOverWt_v_hetOverWt_POSITIVE.pdf", width = plotWidth, height = plotHeight, units = "in")

shank3.go <- setGoScatter(shank3.go)
shank3.go.scatter <- getGoScatter(shank3.go)
# ggsave(plot = shank3.go.scatter, "~/Google Drive/psp/analysis/plots/shank3/goScatter_koOverWt_v_hetOverWt.pdf", width = plotWidth, height = plotHeight, units = "in")
shank3.go.scatter <- shank3.go.scatter + coord_cartesian(xlim=c(0,3), ylim = c(0,3))
ggsave(plot = shank3.go.scatter, "~/Google Drive/psp/analysis/plots/shank3/goScatter_koOverWt_v_hetOverWt_POSITIVE.pdf", width = plotWidth, height = plotHeight, units = "in")

trio.go <- setGoScatter(trio.go)
trio.go.scatter <- getGoScatter(trio.go)
# ggsave(plot = trio.go.scatter, "~/Google Drive/psp/analysis/plots/trio/goScatter_koOverWt_v_hetOverWt.pdf", width = plotWidth, height = plotHeight, units = "in")
trio.go.scatter <- trio.go.scatter + coord_cartesian(xlim=c(0,4), ylim = c(0,3))
ggsave(plot = trio.go.scatter, "~/Google Drive/psp/analysis/plots/trio/goScatter_koOverWt_v_hetOverWt_POSITIVE.pdf", width = plotWidth, height = plotHeight, units = "in")
```

```{r}

pVal <- 10e-5
all.go <- inner_join(grin2a.go, shank3.go, by="pathway", suffix=c(".grin2a", ".shank3"))
all.go <- inner_join(all.go, trio.go, by="pathway")
sig.go <- all.go %>% filter(padj.x.grin2a < pVal | padj.x.shank3 < pVal | padj.x < pVal | padj.y.grin2a < pVal | padj.y.shank3 < pVal | padj.y < pVal)
sig.nes <- sig.go %>% select(pathway, NES.x.grin2a, NES.y.grin2a, NES.x.shank3, NES.y.shank3, NES.x, NES.y)
sig.nes <- sig.nes %>% rename(grin2a.koOverWt=NES.x.grin2a, grin2a.hetOverWt=NES.y.grin2a, shank3.koOverWt=NES.x.shank3, shank3.hetOverWt=NES.y.shank3, trio.koOverWt=NES.x, trio.hetOverWt=NES.y)
sig.nes <- as.data.frame(sig.nes)
rownames(sig.nes) <- substring(sig.nes$pathway,4)
sig.nes <- sig.nes[,c(-1)]
sig.nes.hmap <- Heatmap(sig.nes, row_names_gp = gpar(fontsize = 6), heatmap_legend_param = list(title=NULL))
pdf(file = "~/Google Drive/psp/analysis/plots/heatmap_anySigGo_nes.pdf", width = 5,  height = 40)
sig.nes.hmap
dev.off()
```
```{r}

pVal <- 10e-2
all.go <- inner_join(grin2a.go, shank3.go, by="pathway", suffix=c(".grin2a", ".shank3"))
all.go <- inner_join(all.go, trio.go, by="pathway")
sig.go <- all.go %>% filter(padj.x.grin2a < pVal & padj.x.shank3 < pVal & padj.x < pVal & padj.y.grin2a < pVal & padj.y.shank3 < pVal & padj.y < pVal)
sig.nes <- sig.go %>% select(pathway, NES.x.grin2a, NES.y.grin2a, NES.x.shank3, NES.y.shank3, NES.x, NES.y)
sig.nes <- sig.nes %>% rename(grin2a.koOverWt=NES.x.grin2a, grin2a.hetOverWt=NES.y.grin2a, shank3.koOverWt=NES.x.shank3, shank3.hetOverWt=NES.y.shank3, trio.koOverWt=NES.x, trio.hetOverWt=NES.y)
sig.nes <- as.data.frame(sig.nes)
rownames(sig.nes) <- substring(sig.nes$pathway,4)
sig.nes <- sig.nes[,c(-1)]
sig.nes.hmap <- Heatmap(sig.nes, row_names_gp = gpar(fontsize = 12), heatmap_legend_param = list(title=NULL))
pdf(file = "~/Google Drive/psp/analysis/plots/heatmap_allSigGo_nes.pdf", width = 10,  height = 10)
sig.nes.hmap
dev.off()
```


```{r}
pVal <- 0.1
plotWidth <- 12
plotHeight <- (6/8)*plotWidth
rna.grin2a <- inner_join(rna.grin2a.hom, rna.grin2a.het, suffix=c(".ko",".het"), by="X1")
rna.grin2a <- rna.grin2a %>% drop_na(log2FoldChange.ko, log2FoldChange.het, padj.ko, padj.het)
rna.grin2a <- rna.grin2a %>% mutate(x=log2FoldChange.ko,y=log2FoldChange.het)
rna.grin2a <- rna.grin2a %>% mutate(rna.ko.sig=ifelse(padj.ko < pVal, 1, 0))
rna.grin2a <- rna.grin2a %>% mutate(rna.het.sig=ifelse(padj.het < pVal, 2, 0))
rna.grin2a <- rna.grin2a %>% mutate(rna.both.sig=as.factor(rna.ko.sig + rna.het.sig))
rna.grin2a <- rna.grin2a %>% mutate(color=rna.both.sig)
toPlot <- rna.grin2a %>% select(symbol.ko, x, y, color)

scPlot <- makeScatterPlot(toPlot, lab=c("NS", "Sig. KO/WT", "Sig. Het/WT", "Sig. Both"))
scPlot <- scPlot + xlab("Log2-fold change - RNA (KO/WT)") + ylab("Log2-fold change - RNA (Het/WT)")
scPlot <- scPlot + geom_text_repel(aes(label=ifelse(( x> 0.25 | x < -0.25 |  y> 0.25 | y < -0.25 | color==3), as.character(symbol.ko), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
scPlot
ggsave("~/Google Drive/psp/analysis/plots/grin2a/RNA_koOverWt_v_hetOverWt.pdf", width = plotWidth, height = plotHeight, units = "in")
```



```{r}
rna.grin2a.psd <- inner_join(grin2a.xls, rna.grin2a, by=c("geneSymbol"="symbol.ko"))
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(x=log2FoldChange.ko, y=logFC.KO.over.WT)
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(rna.ko.sig=ifelse(padj.ko < pVal, 1, 0))
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(psd.ko.sig=ifelse(P.Value.WT.over.KO < pVal, 2, 0))
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(rnaPsd.both.sig=as.factor(rna.ko.sig + psd.ko.sig))
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(color=rnaPsd.both.sig)
toPlot <- rna.grin2a.psd %>% select(geneSymbol, x, y, color)
scPlot <- makeScatterPlot(toPlot, lab=c("NS", "Sig. KO/WT (RNA)", "Sig. KO/WT (PSD)", "Sig. Both"))
scPlot <- scPlot + xlab("Log2-fold change - RNA (KO/WT)") + ylab("Log2-fold change - PSD (KO/WT)")
scPlot <- scPlot + geom_text_repel(aes(label=ifelse((color==3), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
scPlot <- scPlot + coord_cartesian(xlim=c(-0.5, 0.5), ylim=c(-7,7))
scPlot
ggsave("~/Google Drive/psp/analysis/plots/grin2a/RNA_koOverWt_v_PSD_koOverWt.pdf", width = plotWidth, height = plotHeight, units = "in")

cytosolicRibosome.curr <- intersect(cytosolicRibosome, rna.grin2a.psd$geneSymbol)
rnaSplicing.curr <- intersect(rnaSplicing, rna.grin2a.psd$geneSymbol)
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(splicing = ifelse(geneSymbol %in% rnaSplicing.curr, 1, 0))
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(cytosolicRibosome = ifelse(geneSymbol %in% cytosolicRibosome.curr, 2, 0))
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(spl.ribo = as.factor(splicing + cytosolicRibosome))
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(color=spl.ribo)
toPlot <- rna.grin2a.psd %>% select(geneSymbol, x, y, color)
scPlot <- makeScatterPlot(toPlot, lab <- c("","RNA splicing", "Cytosolic ribosome","Both"))
scPlot <- scPlot + xlab("Log2-fold change - RNA (KO/WT)") + ylab("Log2-fold change - PSD (KO/WT)")
scPlot <- scPlot + geom_text_repel(aes(label=ifelse(((y>2 | x > .25) & (color==1 | color==2)), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
scPlot <- scPlot + coord_cartesian(xlim=c(-0.5, 0.5), ylim=c(-7,7))
scPlot
ggsave("~/Google Drive/psp/analysis/plots/grin2a/RNA_koOverWt_v_PSD_koOverWt_SPLICING_RIBOSOME.pdf", width = plotWidth, height = plotHeight, units = "in")



rna.grin2a.psd <- rna.grin2a.psd %>% mutate(x=log2FoldChange.het, y=logFC.Het.over.WT)
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(rna.het.sig=ifelse(padj.het < pVal, 1, 0))
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(psd.het.sig=ifelse(P.Value.WT.over.Het < pVal, 2, 0))
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(rnaPsd.het.both.sig = as.factor(rna.het.sig + psd.het.sig))
rna.grin2a.psd <- rna.grin2a.psd %>% mutate(color=rnaPsd.het.both.sig)
toPlot <- rna.grin2a.psd %>% select(geneSymbol, x, y, color)
scPlot <- makeScatterPlot(toPlot, lab=c("NS", "Sig. Het/WT (RNA)", "Sig. Het/WT (PSD)", "Sig. Both"))
scPlot <- scPlot + xlab("Log2-fold change - RNA (Het/WT)") + ylab("Log2-fold change - PSD (Het/WT)")
scPlot <- scPlot + geom_text_repel(aes(label=ifelse((color==3), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
scPlot <- scPlot + coord_cartesian(xlim=c(-0.5, 0.5), ylim=c(-7,7))
scPlot
ggsave("~/Google Drive/psp/analysis/plots/grin2a/RNA_hetOverWt_v_PSD_hetOverWt.pdf", width = plotWidth, height = plotHeight, units = "in")

rna.grin2a.psd <- rna.grin2a.psd %>% mutate(color=spl.ribo)
toPlot <- rna.grin2a.psd %>% select(geneSymbol, x, y, color)
scPlot <- makeScatterPlot(toPlot, lab <- c("","RNA splicing", "Cytosolic ribosome","Both"))
scPlot <- scPlot + xlab("Log2-fold change - RNA (Het/WT)") + ylab("Log2-fold change - PSD (Het/WT)")
scPlot <- scPlot + geom_text_repel(aes(label=ifelse(((y>2 | x > 0.25) & (color==1 | color==2)), as.character(geneSymbol), '')), show.legend = FALSE, segment.color='black', segment.size = .5, segment.alpha = .25, size=3)
scPlot <- scPlot + coord_cartesian(xlim=c(-0.5, 0.5), ylim=c(-7,7))
scPlot
ggsave("~/Google Drive/psp/analysis/plots/grin2a/RNA_hetOverWt_v_PSD_hetOverWt_SPLICING_RIBOSOME.pdf", width = plotWidth, height = plotHeight, units = "in")


```
```{r}
all.xls <- full_join(grin2a.xls, shank3.xls, by="id", suffix=c(".grin2a", ".shank3"))
all.xls <- full_join(all.xls, trio.xls, by="id")
schemaGenes <- as.factor(c("Setd1a", "Cul1", "Xpo7", "Trio", "Cacna1g", "Sp4", "Gria3", "Grin2a", "Herc1", "Rb1cc1", "Hcn4", "Akap11", "Znf136", "Srrm2", "Nr3c2"))
schemaGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% schemaGenes | geneSymbol.grin2a %in% schemaGenes | geneSymbol.shank3 %in% schemaGenes)

cNames <- colnames(schemaGenes.xls)
cNames[6] <- paste(cNames[6], ".trio", sep="")
cNames[7] <- paste(cNames[7], ".trio", sep="")
colnames(schemaGenes.xls) <- cNames

granuleGenes <- read_csv("../data/youn_2018_rna_granule_proteome.csv")
granuleGenes <- str_to_title(granuleGenes$geneSymbol)
granuleGenes.xls <- all.xls %>% select(geneSymbol, geneSymbol.grin2a, geneSymbol.shank3, logFC.KO.over.WT.grin2a, logFC.Het.over.WT.grin2a, logFC.KO.over.WT.shank3, logFC.Het.over.WT.shank3, logFC.KO.over.WT, logFC.Het.over.WT) %>% filter(geneSymbol %in% granuleGenes | geneSymbol.grin2a %in% granuleGenes | geneSymbol.shank3 %in% granuleGenes)
granuleGenes.xls

```

