"0","#rm(list=ls())"
"0","getTopGoTerms<-function(fName, thresh){"
"0","require(""tidyverse"")"
"0","require(""fgsea"")"
"0","#res_fxs <-as_tibble(read.csv(fName)[-c(1:thresh),])"
"0","res_fxs <-as_tibble(read.csv(fName))"
"0","res_fxs <- filter(res_fxs, !X %in% c('Fmr1', 'Rps6kb1'))"
"0","bm<-read_csv(""~/bioChem/ensemblId_mouseGeneName_humanGeneName.csv"")"
"0","res_fxs <- inner_join(res_fxs, bm, by=c(""X""=""external_gene_name""))"
"0","res2_fxs <- res_fxs %>% "
"0","  dplyr::select(hsapiens_homolog_associated_gene_name, stat) %>% "
"0","  na.omit() %>% "
"0","  distinct() %>% "
"0","  group_by(hsapiens_homolog_associated_gene_name) %>% "
"0","  summarize(stat=mean(stat))"
"0","ranks <- deframe(res2_fxs)"
"0","#pathways.go <- gmtPathways(""~/Downloads/geneSets/Mus_musculus_GSEA_GO_sets_bp_symbols_April_2015.gmt"")"
"0","#pathways.go <- gmtPathways(""~/Downloads/geneSets/Human_GO_bp_with_GO_iea_symbol.gmt"")"
"0","#pathways.go <- gmtPathways(""~/Downloads/geneSets/Human_GO_AllPathways_with_GO_iea_April_01_2019_symbol.gmt"")"
"0","# The main one"
"0","pathways.go <- gmtPathways(""~/Google Drive/seqTables/geneSets/c5.all.v7.0.symbols.gmt"")"
"0","#pathways.go <- gmtPathways(""~/Google Drive/seqTables/geneSets/c5.bp.v7.0.symbols.gmt"")"
"0","#pathways.go <- gmtPathways(""~/Google Drive/seqTables/geneSets/h.all.v7.0.symbols.gmt"")"
"0","#pathways.go <- gmtPathways(""~/Downloads/geneSets/MousePath_All_gmt-Format.gmt"")"
"0","fgseaRes_fxs <- fgsea(pathways=pathways.go, stats=ranks, nperm=1000)"
"0","fgseaResTidy_fxs_up <- fgseaRes_fxs %>%"
"0","  as_tibble() %>%"
"0","  arrange(desc(NES), padj)"
"0","fgseaResTidy_fxs_up %>%"
"0","  dplyr::select(-ES, -nMoreExtreme) %>%"
"0","  DT::datatable()"
"0","fgseaResTidy_fxs_down <- fgseaRes_fxs %>%"
"0","  as_tibble() %>%"
"0","  arrange(NES, padj)"
"0","fgseaResTidy_fxs_down %>%"
"0","  dplyr::select(-ES, -nMoreExtreme) %>%"
"0","  DT::datatable()"
"0","nTop <- 10"
"0","top <- bind_rows(fgseaResTidy_fxs_up[1:nTop,], fgseaResTidy_fxs_down[1:nTop,])"
"0","top <- top %>% "
"0","  mutate(pathway = gsub(""\\%.*"","""",pathway)) %>%"
"0","  mutate(pathway = str_to_title(pathway)) %>%"
"0","  mutate(pathway = fct_inorder(pathway)) "
"0","topPathways <- fgseaRes_fxs[head(order(pval), n=20)][order(NES), pathway]"
"0","plotGseaTable(pathways.go[topPathways], ranks,"
"0","              fgseaRes_fxs, gseaParam=0.5)"
"0","return (top)"
"0","}"
"0","plotTopGoTerms<-function(topTab){"
"0","  axisLabSize = 14"
"0","  axisTitleSize=18"
"0","legendLabSize = 18  "
"0","  th <- theme_bw(base_size = 24) +"
"0","  "
"0","  theme("
"0","    legend.background = element_rect(),"
"0","    "
"0","    # axis text"
"0","    axis.text.x = element_text("
"0","      angle = 0,"
"0","      size = axisLabSize,"
"0","      vjust = 1),"
"0","    axis.text.y = element_text("
"0","      angle = 0,"
"0","      size = axisLabSize,"
"0","      vjust = 1),"
"0","    axis.title = element_text("
"0","      size = axisTitleSize),"
"0","    "
"0","    #axis size"
"0","    axis.line = element_line(size = .8),"
"0","    "
"0","    # legend"
"0","    legend.key = element_blank(),"
"0","    legend.text = element_text("
"0","      size = legendLabSize),"
"0","    title = element_text("
"0","      size = legendLabSize),"
"0","    legend.title = element_blank(),"
"0","    "
"0","    #grid"
"0","    panel.grid.major = element_blank(), "
"0","    panel.grid.minor = element_blank(),"
"0","    "
"0","    #panel"
"0","    panel.border = element_blank(), "
"0","    panel.background = element_blank()"
"0","    "
"0","    )"
"0","  "
"0","gp <- ggplot(topTab, aes(x=reorder(pathway, desc(pathway)), y=NES))"
"0","gp <- gp + th"
"0","gp <- gp + geom_col(aes(fill=NES>0), alpha = 0.5, color=""black"", size=.25, show.legend = FALSE)"
"0","#gp <- gp + scale_x_discrete(limits=rev(levels(pathway)))"
"0","gp <- gp + coord_flip()"
"0","gp <- gp + scale_fill_brewer(palette = ""Set1"")"
"0","gp <- gp + ylab(""Normalized Enrichment Score"")"
"0","gp <- gp + xlab(""Biological pathway"")"
"0","return (gp)"
"0","}"
